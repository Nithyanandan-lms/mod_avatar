define("mod_avatar/avatar_assign",["jquery","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/notification","core/str"],(($,ModalFactory,ModalEvents,Fragment,Ajax,Notification,Str)=>{var SELECTORS_ASSIGN_AVATAR_BTN=".avatar-assign-btn",SELECTORS_UPGRADE_AVATAR_BTN="table#avatar_report td a.avatar-upgrade-btn";return{init:cmid=>{var _document$querySelect,_document$querySelect2;null===(_document$querySelect=document.querySelector(SELECTORS_ASSIGN_AVATAR_BTN))||void 0===_document$querySelect||_document$querySelect.addEventListener("click",(e=>{e.preventDefault();var userid=e.currentTarget.dataset.userid;((cmid,userid)=>{ModalFactory.create({type:ModalFactory.types.DEFAULT,title:Str.get_string("assignnewavatar","mod_avatar"),body:Fragment.loadFragment("mod_avatar","available_avatars",1,{cmid:cmid,userid:userid}),large:!0}).then((modal=>(modal.show(),modal.getRoot().on("click",".assign-avatar-btn",(e=>{var _form$querySelector;e.preventDefault();var form=e.currentTarget.querySelector("form");Ajax.call([{methodname:"mod_avatar_collect_avatar",args:{avatarid:null===(_form$querySelector=form.querySelector('input[name="avatarid"]'))||void 0===_form$querySelector?void 0:_form$querySelector.value,cmid:cmid,userid:userid},done:response=>{response.success?window.location.reload():Notification.addNotification({message:response.message,type:"error"})},fail:Notification.exception}])})),modal.getRoot().on("click",".upgrade-avatar-btn",(e=>{var _form$querySelector2;e.preventDefault();var form=e.currentTarget.querySelector("form");Ajax.call([{methodname:"mod_avatar_upgrade_avatar",args:{avatarid:null===(_form$querySelector2=form.querySelector('input[name="avatarid"]'))||void 0===_form$querySelector2?void 0:_form$querySelector2.value,cmid:cmid,userid:userid},done:response=>{response.success?window.location.reload():Notification.addNotification({message:response.message,type:"error"})},fail:Notification.exception}])})),modal)))})(cmid,userid)})),null===(_document$querySelect2=document.querySelector(SELECTORS_UPGRADE_AVATAR_BTN))||void 0===_document$querySelect2||_document$querySelect2.addEventListener("click",(e=>{e.preventDefault();var userid=e.currentTarget.dataset.userid,avatarid=e.currentTarget.dataset.avatarid;Ajax.call([{methodname:"mod_avatar_upgrade_avatar",args:{avatarid:avatarid,cmid:cmid,userid:userid},done:response=>{response.success?window.location.reload():Notification.addNotification({message:response.message,type:"error"})},fail:Notification.exception}])}))},pickAvatar:function(){var _document$querySelect3;null===(_document$querySelect3=document.querySelectorAll(".collect-avatar, .upgrade-avatar"))||void 0===_document$querySelect3||_document$querySelect3.forEach((element=>element.addEventListener("click",(function(e){e.preventDefault();var avatarId=e.currentTarget.dataset.avatarid,cmid=e.currentTarget.dataset.cmid,methodName="collect"===(e.currentTarget.classList.contains("collect-avatar")?"collect":"upgrade")?"mod_avatar_collect_avatar":"mod_avatar_upgrade_avatar";Ajax.call([{methodname:methodName,args:{avatarid:avatarId,cmid:cmid},done:function(response){Notification.addNotification({message:response.message,type:response.success?"success":"error"}),response.success&&window.location.reload()},fail:Notification.exception}])}))))}}}));

//# sourceMappingURL=avatar_assign.min.js.map